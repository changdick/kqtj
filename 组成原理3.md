# 组成原理3 存储器

## 存储器的基本概念
我们学习的存储器的内容，包括主存储器，主存储器就是随机存储器RAM，分为SRAM和DRAM，分别学习他们的存储原理和例子。还学习存储信息的校验，尤其是汉明码校验。还有高速缓冲存储器。 

### 存储器的技术指标
**存储容量**：存储容量是存储器中能存储的0和1的个数。单位可以是bit也可以是字节Byte。单位还有KB，存储器这里讨论的这个K，就是2的十次方的意思。在题目中会遇到1K×8位的存储芯片，1k指的就是有10根地址线进行选址，所以有正好 $2^{10}=$1k个的不同地址，也就是有1k个寻址单元，而每个单元存储8个数字（8 bit），就是1k × 8。

**寻址单位和寻址范围**：寻址可以按字节为单位寻址，也可以按字为单位寻址。字长可以是16位也可以是32位，rV32就是按字节为单位寻址，并且字长32位。但是字长是看题目假设的，寻址单位也是题目可以假设的。但方法是一样的。用不一样的寻址单位，会有不同的寻址范围。给定存储容量的芯片，寻址单位用的大，能编出来的地址就小，寻址范围就小。快速的算这个要用2的次方。例如给定16MB（ $2^{27}$）的存储器。我们把 $2^{27}$拆分：
1. $2^{24}\times2^{3}$  字节为单位寻址 寻址范围是 $2^{24}$即16M，地址可以编到16M， 总容量是16MB。 如果要换位为单位，那容量是128M位。

## 主存储器

### 存储器与CPU连接 （例题）
首先需要清楚存储器这个器件有哪些信号要连接的。
#### 半导体存储芯片的一般结构 
地址线：用于选择和外面交互的存储单元。（存储器内部有线选法和重合法寻址，实际上用重合法寻址）  
数据线：数据线是双向的，进行数据读写。  
片选线：片选线给有效信号，表示选中了这一片存储芯片，它才有效工作。  
读写控制线：用于控制读写。
#### CPU的线和连接要点
CPU参与连接的线只有4种，访存控制信号 $\overline{MREQ}$,地址线，数据线，读写命令线。  

要点：
1. CPU的地址线比存储芯片的地址线多，所以不是一一对应的，CPU的线多出来的整合生成成片选信号。地址看的是CPU的地址线。
2. 数据线的连接：一切以CPU的数据线条数为准，CPU的数据线有几条，意味着寻址单位是多少位，一般CPU数据线条数多于存储器的数据线位数，这意味着存储器要用多片，进行位扩展。
3. 片选线的连接：按照解题步骤做，会发现低位用于地址线后，使用不同芯片的，CPU地址线高位是不一样的，不一样的就拿来生成片选信号，接到存储芯片的片选线上。而访存控制信号一定要参加到片选信号的生成中。
4. 读写信号连接：CPU读写命令线可以直接连到存储芯片读写控制端。
5. 存储芯片的选择： 用户程序用RAM，系统程序用ROM

#### 例题
例1： 设CPU有16根地址线，8根数据线，访存控制信号 $\overline{MREQ}$低电平有效，读写信号 $\overline{WR}$高电平读、低电平写，提供以下几种存储芯片：RAM ：1K×4位；4K×8位；8K×8位；  ROM ：2K×8位；4K×8位；8K×8位。 还提供74L138译码器和各种门电路。 给CPU连接存储器，要求 1）主存地址空间分配： 6000H-67FFH为系统程序区， 6800H-6BFFH为用户程序区。 

解析： 有固定的解题步骤。按照步骤来做题。此题的储存地址范围，是题目提供给我们的，主存地址分配，题目提供了。而寻址单位，即一个地址存多少位，是CPU数据线数提供的。  
（1） 写出对应的二进制地址码。
```
0110 0000 0000 0000
...                       系统程序区
0110 0111 1111 1111

0110 1000 0000 0000
...                       用户程序区
0110 1011 1111 1111

```
（2）分析寻址范围，确定芯片类型和数量  
数据有几位，看CPU的数据线，所以读写都是8位作为单位的。地址范围有多少，就看写出来的二进制码。我们看系统程序区的，A0到A10一共11位有变化，所以这就是地址范围，11根地址线，就是2的11次方，就是2K， 所以系统程序区，是2k × 8位。 刚好有提供了一个2K×8位的ROM芯片，就可以直接使用。  
同理，看用户程序区，地址是10根线在变化，所以是1K×8位，所以要在RAM中，选两片1K×4位的，进行一个位扩展。  

（3）分配地址线  
地址线有16条，但我们真正分配给存储芯片地址线的，分别是11条和10条。所以会有多出来的。这时候要分配，哪些作为存储器地址线，哪些作为片选信号。这题高5位就是作为片选信号（实际上只有A11体现了不同），A10-A0给系统程序区那块芯片，A9-A0给用户程序区那两块芯片。如果我们要用74L138译码器，那选择控制信号只有3条，我们可以分配成：A15、A14当使能信号，A13-A11当选择控制端。  

（4）确定片选信号
根据选择好的CPU地址线，设计出片选信号。比如A13-A11连到了三八译码器的选择控制端，那实际上两个值是100和101，就把Y5和Y4的信号连出来，分别当片选信号。但是这里对于1k×4位的那两个芯片，似乎A10信号没有用上。可以把A10和Y5的信号综合一下，过一个与门，只有两个都是0，才能给到片选信号给芯片。  

例2： 假设同前，要求最小的 4K为系统程序区，相邻8K为用户程序区。  

解析：题目同样给我们提供了寻址范围，他说的最小4K，只的是从0开始算最小。 
（1）写出二进制地址码：4k就是 $2^{12}$，所以要调动12根地址线，可以快速得到是低12位从全0变到全1。    
```
0000 0000 0000 0000
...                      系统程序区 4K×8位
0000 1111 1111 1111
0001 0000 0000 0000      这是用户程序区那8K的开端
...                      用户程序区 8K×8位
0010 1111 1111 1111      算出这个，用了个技巧：按住低10位不动，给前面的把A10当作“1”，给前面加上8，再减1。

0001 0000 0000 0000
...                       4K×8位
0001 1111 1111 1111              用两个在按照寻址范围扩展（字扩展）
0010 0000 0000 0000
...                       4K×8位
0010 1111 1111 1111

```
（2）确定芯片类型   
系统程序区是4K×8位，用户程序区8K×8位，那系统程序区可以直接有对应的ROM。（用户程序区，完全可以直接用8K乘8位的来做。但可能是想地址线分配好分，答案使用2个4K×8位）。那么两个4K×8位，要再细分一下地址范围。   
（3）分配地址线   
可以统一把低12位用作连接存储器的地址线，高4位用来生成片选信号。   
（4） 确定片选信号   
可以把A14-A12用来接到38译码器的3个输入，那么输出Y0、Y1、Y2刚好就分别用于寻三个地址。A15可以接给使能。访存控制信号是肯定要作为使能信号接译码器上。译码器多出来一个使能信号而CPU以及连满了，可以直接接高电平。
